<style>
  .featured-collections-{{ section.id }} .featured-collection-item {
    border-radius: {{ section.settings.item_border_radius }}px;
  }
</style>

{% liquid
  assign image_ratio = 1
%}
{%- if section.blocks.size > 0 -%}
  <section
    class="featured-collections featured-collections-{{ section.id }} pt-48 pb-56 pt-20 pb-20"
    data-section-type="featured-collections"
    data-section-id="{{ section.id }}"
  >
    <div class="page-width">
      <div 
        class="grid gap-16 lg:gap-10 md:gap-10 
          {% if section.blocks.size == 1 %}grid-cols-1{% endif %}
          {% if section.blocks.size == 2 %}grid-cols-2{% endif %}
          {% if section.blocks.size == 3 %}grid-cols-3{% endif %}
          {% if section.blocks.size == 4 %}grid-cols-4{% endif %}
          lg:grid-cols-4 md:grid-cols-4 sm:hidden"
        data-blocks-count="{{ section.blocks.size }}"
      >
        {%- for block in section.blocks -%}
          {%- liquid
            assign collection = collections[block.settings.collection]
            assign collection_url = block.settings.custom_url
            assign collection_title = block.settings.custom_title
            assign collection_image = block.settings.custom_image
          -%}

          <div class="featured-collection-item relative transition-transform" {{ block.shopify_attributes }}>
            <a href="{{ collection_url }}" class="block no-underline text-inherit h-full" aria-label="{{ collection_title }}">
              <div
                class="relative h-full overflow-hidden object-contain media block relative"
                style="padding-top: {{ 1 | divided_by: image_ratio | times: 100 }}%;"
              >
                {%- if collection and collection_image -%}
                  {%- capture sizes %}{% render 'sizes-attribute', grid: true, min: 1, sm: 2, lg: 3, xl: 4 %}{% endcapture -%}
                  {% render 'image',
                    image: collection_image,
                    widths: '304, 304, 304, 304',
                    src_width: 304,
                    sizes: sizes,
                    class: 'img-fit',
                    quality: 1
                  %}
                {%- else -%}
                  <div class="relative h-full overflow-hidden object-contain">
                    {{ 'collection-1' | placeholder_svg_tag: 'placeholder-svg collection-img' }}
                  </div>
                {%- endif -%}
              </div>
            </a>
          </div>
        {%- endfor -%}
      </div>

      <div class="hidden sm:block">
        <slideshow-component
          data-autoplay="{{ section.settings.autoplay }}"
          data-autoplay-delay="{{ section.settings.autoplay_delay | default: 5000 }}"
          data-pause-on-hover="{{ section.settings.pause_on_hover }}"
          data-slides-per-view-desktop="4"
          data-show-partial-slides="true"
          data-show-progress-bar="false"
          data-carousel-mode="true"
          data-slide-width-mobile="304px"
          data-slide-width-tablet="304px"
          data-slide-width-desktop="304px"
        >
          <div class="swiper-container">
            <div class="swiper-wrapper flex gap-16">
              {%- for block in section.blocks -%}
                <div class="swiper-slide">
                  {%- liquid
                    assign collection = collections[block.settings.collection]
                    assign collection_url = block.settings.custom_url
                    assign collection_title = block.settings.custom_title
                    assign collection_image = block.settings.custom_image
                  -%}

                  <div class="featured-collection-item relative transition-transform sm:w-304 sm:h-304" {{ block.shopify_attributes }}>
                    <a href="{{ collection_url }}" class="block no-underline text-inherit h-full" aria-label="{{ collection_title }}">
                      <div class="relative h-full overflow-hidden object-contain media block relative">
                        {%- if collection and collection_image -%}
                          {%- capture sizes %}{% render 'sizes-attribute', grid: true, min: 1, sm: 2, lg: 3, xl: 4 %}{% endcapture -%}
                          {% render 'image',
                            image: collection_image,
                            widths: '304, 304, 304, 304',
                            src_width: 304,
                            sizes: sizes,
                            class: 'img-fit',
                            quality: 1
                          %}
                        {%- else -%}
                          <div class="relative h-full overflow-hidden object-contain">
                            {{ 'collection-1' | placeholder_svg_tag: 'placeholder-svg collection-img' }}
                          </div>
                        {%- endif -%}
                      </div>
                    </a>
                  </div>
                </div>
              {%- endfor -%}
            </div>
          </div>
        </slideshow-component>
      </div>
    </div>
  </section>
{%- endif -%}

{% schema %}
{
  "name": "Featured Collections",
  "tag": "section",
  "class": "section-featured-collections",
  "settings": [
    {
      "type": "range",
      "id": "item_border_radius",
      "min": 0,
      "max": 20,
      "step": 1,
      "unit": "px",
      "label": "Item border radius",
      "default": 0
    },
    {
      "type": "header",
      "content": "Mobile Carousel Settings"
    },
    {
      "type": "checkbox",
      "id": "autoplay",
      "default": false,
      "label": "Auto-play carousel"
    },
    {
      "type": "range",
      "id": "autoplay_delay",
      "min": 1000,
      "max": 9000,
      "step": 500,
      "default": 5000,
      "label": "Auto-play delay (ms)",
      "info": "Time between slide transitions"
    },
    {
      "type": "checkbox",
      "id": "pause_on_hover",
      "default": true,
      "label": "Pause on hover"
    }
  ],
  "blocks": [
    {
      "type": "collection",
      "name": "Collection",
      "settings": [
        {
          "type": "collection",
          "id": "collection",
          "label": "Collection"
        },
        {
          "type": "image_picker",
          "id": "custom_image",
          "label": "Custom Image",
          "info": "Optional: Override collection's featured image"
        },
        {
          "type": "url",
          "id": "custom_url",
          "label": "Custom URL",
          "info": "Optional: Override collection URL"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "Featured Collections",
      "blocks": [
        {
          "type": "collection"
        },
        {
          "type": "collection"
        },
        {
          "type": "collection"
        },
        {
          "type": "collection"
        }
      ]
    }
  ]
}
{% endschema %}
