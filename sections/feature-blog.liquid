{% assign minShown = 4 %}
{% assign articleCount = section.settings.blog.articles.size %}
{% if articleCount < minShown %}
  {% assign minShown = articleCount %}
{% endif %}
{% assign image_ratio = 1 %}
<style>
  .blog-section__content-grid {
    grid-template-columns: repeat({{ minShown }}, 1fr);
  }

  @media screen and (max-width: 768px) {
    .swiper-slide:last-child {
      margin-right: 0;
    }
  }
</style>

<article class="blog-section blog-section-{{ section.id }} pt-0 pb-88 pt-16 pb-16">
  <div class="blog-section__container page-width flex flex-col gap-48 sm:gap-16">
    {% if section.settings.blog_title != blank %}
      <div class="blog-section__title fs-36-lh-40-ls-0 ff-bebas-neue fw-400 sm:fs-21-lh-24-ls-1_2pct text-center uppercase">
        {{ section.settings.blog_title }}
      </div>
    {% endif %}

    <!-- Desktop Grid -->
    <div class="blog-section__content-grid grid gap-16 sm:hidden">
      {% for article in section.settings.blog.articles limit: section.settings.blog_post_limit %}
        <div class="blog-card flex flex-col gap-16">
          <div class="blog-card__image__container h-154 relative w-full">
            {% if article.image %}
              {%- capture sizes %}{% render 'sizes-attribute' %}{% endcapture -%}
              <div
                class="media w-full"
                style="padding-top: {{ 1 | divided_by: image_ratio | times: 100 }}%;"
              >
                {% render 'image',
                  image: article.image,
                  widths: '304, 304, 304, 304',
                  src_width: 304,
                  sizes: sizes,
                  class: 'img-fit',
                  quality: 1
                %}
              </div>
            {% else %}
              {{ 'image' | placeholder_svg_tag: 'blog-card__image' }}
            {% endif %}
          </div>
          <div class="blog-card__content flex flex-col gap-8">
            <h3 class="blog-card__title ff-general-sans fs-23-lh-24-ls-0 fw-500 sm:fs-17-lh-24-ls-0 m-0">
              {{ article.title }}
            </h3>
            <p class="blog-card__excerpt m-0 text-label-light ff-general-sans fs-14-lh-20-ls-0 fw-400">
              {{ article.content | strip_html | truncatewords: 20 }}
            </p>
          </div>
        </div>
      {% endfor %}
    </div>

    <!-- Mobile Swiper -->
    <div class="blog-section__content-swiper hidden sm:block relative pb-20">
      <slideshow-component
        data-autoplay="false"
        data-show-progress-bar="true"
        data-slides-per-view-desktop="2"
        data-single-slide-view="true"
        data-carousel-mode="true"
        data-slide-width-mobile="304px"
        data-slide-width-tablet="304px"
        data-slide-width-desktop="304px"
      >
        <div class="swiper-container flex flex-col gap-16">
          <div class="swiper-wrapper gap-16">
            {% for article in section.settings.blog.articles limit: section.settings.blog_post_limit %}
              <div class="swiper-slide blog-card flex flex-col gap-16">
                <div class="blog-card__image__container h-154 relative w-full">
                  {% if article.image %}
                    {%- capture sizes %}{% render 'sizes-attribute' %}{% endcapture -%}
                    <div
                      class="media w-full"
                      style="padding-top: {{ 1 | divided_by: image_ratio | times: 100 }}%;"
                    >
                      {% render 'image',
                        image: article.image,
                        widths: '304, 304, 304, 304',
                        src_width: 304,
                        sizes: sizes,
                        class: 'img-fit',
                        quality: 1
                      %}
                    </div>
                  {% else %}
                    {{ 'image' | placeholder_svg_tag: 'blog-card__image' }}
                  {% endif %}
                </div>
                <div class="blog-card__content flex flex-col gap-8">
                  <h3 class="blog-card__title ff-general-sans fs-23-lh-24-ls-0 fw-500 m-0">{{ article.title }}</h3>
                  <p class="blog-card__excerpt m-0 text-label-light ff-general-sans fs-14-lh-20-ls-0 fw-400">
                    {{ article.content | strip_html | truncatewords: 20 }}
                  </p>
                </div>
              </div>
            {% endfor %}
          </div>
        </div>
      </slideshow-component>
    </div>
  </div>
</article>

{% schema %}
{
  "name": "Blog",
  "disabled_on": {
    "groups": ["header", "footer"]
  },
  "settings": [
    {
      "type": "blog",
      "id": "blog",
      "label": "Select Blog"
    },
    {
      "type": "text",
      "id": "blog_title",
      "label": "Section Title",
      "default": "Our Blog"
    },
    {
      "type": "range",
      "id": "blog_post_limit",
      "label": "Number of blog posts to show",
      "min": 1,
      "max": 20,
      "step": 1,
      "default": 4
    }
  ],
  "presets": [
    {
      "name": "Blog"
    }
  ]
}
{% endschema %}
