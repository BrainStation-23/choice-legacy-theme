<div class="customer-account pt-40 pb-0 sm:pt-0">
  <div class="customer-account__container flex gap-64 lg:gap-32 md:gap-24 page-width">
    <div>
      {% render 'customer-account-sidebar' %}
    </div>

    <div class="customer-account__content" style="flex: 2;">
      <div id="my-profile-content" class="account-content-section" style="display: none;">
        {% render 'account-information', customer: customer %}
      </div>

      <div id="my_beauties_profile-content" class="account-content-section" style="display: none;">
        <div id="my_beauties_profile-section">
          {% comment %} Add your beauties profile content here {% endcomment %}
          <h2>My Beauties Profile</h2>
          <p>Customize your beauty preferences and profile.</p>
        </div>
      </div>

      <div id="orders-content" class="account-content-section" style="display: none;">
        <div id="orders-section">
          {% render 'orders-list', orders: customer.orders %}
        </div>
      </div>

      {% comment %}
        <div id="addresses-content" class="account-content-section" style="display: none;">
          <div id="addresses-section">
            {% render 'customer-addresses', customer: customer %}
          </div>
        </div>
      {% endcomment %}

        <div id="rewards-content" class="account-content-section" style="display: none;">
          <div id="rewards-section">
            {% render 'reward-points', section: section %}
          </div>
        </div>
    

      <div id="wishlist-content" class="account-content-section" style="display: none;">
        <div id="wishlist-section">
          {% render 'wishlist' %}
        </div>
      </div>

      <div id="support-content" class="account-content-section" style="display: none;">
        <div id="support-section">
          {% render 'support' %}
        </div>
      </div>

      <div id="reviews-content" class="account-content-section" style="display: none;">
        <div id="reviews-section">
          {% render 'reviews' %}
        </div>
      </div>
    </div>
  </div>
</div>

<script src="{{ 'pagination.js' | asset_url }}" defer></script>

<script>
  let loadedSections = ['my-profile'];
  let deliveryStatusLoaded = false;

  async function showAccountContent(contentType) {
    if (contentType !== 'support' && typeof window.stopSupportChatPolling === 'function') {
      window.stopSupportChatPolling();
    }

    const contentSections = document.querySelectorAll('.account-content-section');
    contentSections.forEach((section) => {
      section.style.display = 'none';
    });

    if (contentType === 'logout') {
      window.location.href = '/account/logout';
      return;
    }

    if (contentType === 'addresses') {
      window.location.href = '/account/addresses';
      return;
    }

    if (contentType === 'coming-soon') {
      contentType = 'my_profile';
    }

    let targetContentType = contentType;

    const contentMapping = {
      'my-profile': 'my-profile',
      my_profile: 'my-profile',
      my_beauties_profile: 'my_beauties_profile',
      orders: 'orders',
      addresses: 'addresses',
      rewards: 'rewards',
      wishlist: 'wishlist',
      support: 'support',
      reviews: 'reviews',
    };

    targetContentType = contentMapping[contentType] || 'my-profile';

    if (targetContentType === 'support' && !loadedSections.includes('support')) {
      if (typeof window.initializeSupportChat === 'function') {
        window.initializeSupportChat();
      }
      loadedSections.push('support');
    }

    const targetContent = document.getElementById(targetContentType + '-content');
    if (targetContent) {
      targetContent.style.display = 'block';
    } else {
      const profileContent = document.getElementById('my-profile-content');
      if (profileContent) {
        profileContent.style.display = 'block';
      }
    }
  }

  // Get initial content type from URL parameters and path
  function getInitialContentType() {
    const currentPath = window.location.pathname;
    const urlParams = new URLSearchParams(window.location.search);
    const navParam = urlParams.get('nav');

    // Check URL path for sub-pages first (highest priority)
    if (currentPath.includes('/account/orders')) {
      return 'orders';
    }
    if (currentPath.includes('/account/addresses')) {
      return 'addresses';
    }
    if (currentPath.includes('/account/rewards')) {
      return 'rewards';
    }

    // Then check query parameter
    if (navParam) {
      return navParam;
    }

    // Check for legacy hash-based navigation
    if (window.location.hash === '#orders-section') {
      return 'orders';
    }

    // Check for pagination (legacy orders page detection)
    if (window.location.search.includes('page=')) {
      return 'orders';
    }

    // Return default
    return 'my_profile';
  }

  // Initialize page content based on URL parameters
  function initializePageContent() {
    const initialContentType = getInitialContentType();
    showAccountContent(initialContentType);
  }

  // Handle browser back/forward navigation
  function handlePopState() {
    const contentType = getInitialContentType();
    showAccountContent(contentType);
  }

  // Make showAccountContent globally available
  window.showAccountContent = showAccountContent;

  // Initialize when DOM is ready
  document.addEventListener('DOMContentLoaded', function () {
    initializePageContent();

    // Listen for browser navigation events
    window.addEventListener('popstate', handlePopState);
  });
</script>

<script>
  window.customerPurchasedProducts = [
    {%- for order in customer.orders -%}
      {%- for item in order.line_items -%}
        {
          "productId": {{ item.product_id }},
          "productHandle": "{{ item.product.handle | escape }}",
          "variantId": {{ item.variant_id }},
          "orderId": {{ order.id }},
          "orderName": {{ order.name | json }},
          "orderTotalPrice": {{ order.total_price }},
          "orderCustomerUrl": "{{ order.customer_url | escape }}"
        }
        {%- unless forloop.parentloop.last and forloop.last -%},{%- endunless -%}
      {%- endfor -%}
    {%- endfor -%}
  ];
</script>

<style>
  @media screen and (max-width: 768px) {
    .customer-account__container {
      flex-direction: column;
      gap: 16px !important;
    }
  }

  .account-content-section {
    transition: opacity 0.2s ease-in-out;
  }
</style>

{% schema %}
{
  "name": "Main Account",
  "settings": []
}
{% endschema %}
