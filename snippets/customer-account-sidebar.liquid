<style>
  .customer-account__sidebar-item:hover {
    border-bottom-color: rgb(var(--color-primary-brand));
    cursor: pointer;
    color: rgb(var(--color-primary-brand));
  }
  .customer-account__sidebar-item:hover .account-sidebar-item-title {
    color: rgb(var(--color-primary-brand));
  }
  .customer-account__sidebar-item:hover .customer-account__sidebar-item svg {
    height: 28px !important;
    width: 28px !important;
  }

  .customer-account__sidebar-item.active {
    border-bottom: 2px solid rgb(var(--color-primary-brand));
    color: rgb(var(--color-primary-brand));
  }

  .customer-account__sidebar-item.active .account-sidebar-item-title {
    color: rgb(var(--color-primary-brand));
  }

  @media (max-width: 768px) {
    .customer-account__sidebar-selected:hover {
      border-color: rgba(var(--color-primary-brand), 0.3);
    }

    .dropdown-arrow.expanded {
      transform: rotate(180deg);
    }

    .customer-account__sidebar-dropdown.expanded {
      max-height: 500px;
      opacity: 1;
    }
  }
</style>

<aside class="customer-account__sidebar w-296 sm:w-full p-16 border-1 border-solid  border-color rounded-6 sm:border-none sm:relative sm:p-0">
  <div
    class="customer-account__sidebar-selected hidden sm:flex  items-center justify-between sm:p-16 sm:border-b sm:border-b-color sm:border-b-solid m-0 cursor-pointer w-full"
    onclick="toggleDropdown()"
  >
    <div class="selected-content sm:flex gap-8 items-center " id="selected-item-content">
      {% render 'accounts-icon' %}
      <h2 class="account-sidebar-item-title ff-general-sans fs-16-lh-16-ls-0 fw-500 text-primary-90pct m-0">
        {{ 'customer.account.myaccount' | t }}
      </h2>
    </div>
    <div
      class="dropdown-arrow hidden sm:block sm:transition-transform-2s sm:w-20 sm:h-20 sm:text-primary-60pct"
      id="dropdown-arrow"
    >
      {% render 'icon-arrow-down', height: '32', width: '32' %}
    </div>
  </div>

  <div
    class="customer-account__sidebar-dropdown box-shadow static max-h-none opacity-1  bg-none border-none box-shadow-none m-0 overflow-visible sm:absolute sm:top-100pct sm:left-0 sm:right-0 sm:bg-bg sm:border-1 sm:border-solid sm:border-color sm:rounded-6 sm:mt-4 sm:z-100 sm:overflow-hidden sm:max-h-0 sm:opacity-0 sm:transition-transform-all"
    id="dropdown-menu"
  >
    <ul class="customer-account__sidebar-items m-0 p-0 list-style-none">
      <div
        class="customer-account__sidebar-item  my-profile gap-8 flex items-center pt-12 pb-12 pl-0 pr-0 text-primary-90pct border-b-2 border-b-solid border-color-transparent sm:p-16 sm:border-b sm:border-b-color sm:border-b-solid sm:transition-transform-2s cursor-pointer"
        data-tab="my-profile"
        onclick="selectItem(this, 'accounts-icon', '{{ 'customer.account.myaccount' | t }}', 'my-profile')"
      >
        {% render 'accounts-icon' %}
        <h2 class="account-sidebar-item-title ff-general-sans fs-16-lh-16-ls-0 fw-500 text-primary-90pct m-0">
          {{ 'customer.account.myaccount' | t }}
        </h2>
      </div>
      <div
        class="customer-account__sidebar-item gap-8  flex items-center pt-12 pb-12 pl-0 pr-0 text-primary-90pct border-b-2 border-b-solid border-color-transparent sm:p-16 sm:border-b sm:border-b-color sm:border-b-solid sm:transition-transform-2s cursor-pointer"
        data-tab="my-beauties-profile"
        onclick="selectItem(this, 'brash-icon', '{{ 'customer.account.beauty_profile' | t }}', 'beauty_profile')"
      >
        {% render 'brash-icon' %}
        <h2 class="account-sidebar-item-title ff-general-sans fs-16-lh-16-ls-0 fw-500 text-primary-90pct m-0">
          {{ 'customer.account.beauty_profile' | t }}
        </h2>
      </div>

      <div
        class="customer-account__sidebar-item gap-8 flex items-center pt-12 pb-12 pl-0 pr-0 border-b-2 border-b-solid border-color-transparent  sm:p-16 text-primary-90pct sm:border-b sm:border-b-color sm:border-b-solid sm:transition-transform-2s cursor-pointer"
        data-tab="orders"
        onclick="selectItem(this, 'order-menu-icon', '{{ 'customer.account.orders' | t }}', 'orders')"
      >
        {% render 'order-menu-icon' %}
        <h2 class="account-sidebar-item-title ff-general-sans fs-16-lh-16-ls-0 fw-500 text-primary-90pct m-0">
          {{ 'customer.account.orders' | t }}
        </h2>
      </div>
      <div
        class="customer-account__sidebar-item gap-8 flex items-center pt-12 pb-12 pl-0 pr-0 text-primary-90pct border-b-2 border-b-solid border-color-transparent sm:p-16 sm:border-b sm:border-b-color sm:border-b-solid sm:transition-transform-2s cursor-pointer"
        data-tab="addresses"
        onclick="selectItem(this, 'address-icon', '{{ 'customer.account.addresses' | t }}', 'addresses')"
      >
        {% render 'address-icon' %}
        <h2 class="account-sidebar-item-title ff-general-sans fs-16-lh-16-ls-0 fw-500 text-primary-90pct m-0">
          {{ 'customer.account.addresses' | t }}
        </h2>
      </div>

      <div
        class="customer-account__sidebar-item gap-8 flex items-center pt-12 pb-12 pl-0 pr-0 text-primary-90pct border-b-2 border-b-solid border-color-transparent sm:p-16 sm:border-b sm:border-b-color sm:border-b-solid sm:transition-transform-2s cursor-pointer"
        data-tab="rewards"
        onclick="selectItem(this, 'reward-icon', '{{ 'customer.account.rewards' | t }}', 'rewards')"
      >
        {% render 'reward-icon' %}
        <h2 class="account-sidebar-item-title ff-general-sans fs-16-lh-16-ls-0 fw-500 text-primary-90pct m-0">
          {{ 'customer.account.rewards' | t }}
        </h2>
      </div>
      <div
        class="customer-account__sidebar-item gap-8 flex items-center pt-12 pb-12 pl-0 pr-0 text-primary-90pct border-b-2 border-b-solid border-color-transparent sm:p-16 sm:border-b sm:border-b-color sm:border-b-solid sm:transition-transform-2s cursor-pointer"
        data-tab="wishlist"
        onclick="selectItem(this, 'love-icon', '{{ 'customer.account.wishlist' | t }}', 'wishlist')"
      >
        {% render 'love-icon' %}
        <h2 class="account-sidebar-item-title ff-general-sans fs-16-lh-16-ls-0 fw-500 text-primary-90pct m-0">
          {{ 'customer.account.wishlist' | t }}
        </h2>
      </div>
      <div
        class="customer-account__sidebar-item gap-8 flex items-center justify-between pt-12 pb-12 pl-0 pr-0 text-primary-90pct border-b-2 border-b-solid border-color-transparent sm:p-16 sm:border-b sm:border-b-color sm:border-b-solid sm:transition-transform-2s cursor-pointer"
        data-tab="support"
        onclick="selectItem(this, 'icon-support', '{{ 'customer.account.support' | t }}', 'support')"
      >
        <div class="flex flex-8 items-center">
          {% render 'icon-chat' %}
          <h2 class="account-sidebar-item-title ff-general-sans fs-16-lh-16-ls-0 fw-500 text-primary-90pct m-0">
            {{ 'customer.account.support' | t }}
          </h2>
        </div>
        <span
          id="unread-messages-count"
          class="bg-brand hidden text-bg fw-400 fs-14-lh-20-ls-0 w-20 h-20 rounded-full flex justify-center items-center"
        ></span>
      </div>
      <div
        class="customer-account__sidebar-item gap-8 flex items-center pt-12 pb-12 pl-0 pr-0 text-primary-90pct border-b-2 border-b-solid border-color-transparent sm:p-16 sm:border-b sm:border-b-color sm:border-b-solid sm:transition-transform-2s cursor-pointer"
        data-tab="reviews"
        onclick="selectItem(this, 'star-icon', '{{ 'customer.account.reviews' | t }}', 'reviews')"
      >
        {% render 'star-icon' %}
        <h2 class="account-sidebar-item-title ff-general-sans fs-16-lh-16-ls-0 fw-500 text-primary-90pct m-0">
          {{ 'customer.account.reviews' | t }}
        </h2>
      </div>
      <div
        class="customer-account__sidebar-item gap-8 flex items-center pt-12 pb-12 pl-0 pr-0 text-primary-90pct border-b-2 border-b-solid border-color-transparent sm:p-16 sm:border-b sm:border-b-color sm:border-b-solid sm:transition-transform-2s cursor-pointer"
        data-tab="logout"
        onclick="selectItem(this, 'logout-icon', '{{ 'customer.account.logout' | t }}', 'logout')"
      >
        {% render 'logout-icon' %}
        <h2 class="account-sidebar-item-title ff-general-sans fs-16-lh-16-ls-0 fw-500 text-primary-90pct m-0">
          {{ 'customer.account.logout' | t }}
        </h2>
      </div>
    </ul>
  </div>
</aside>

<script>
  class SidebarNavigation {
    constructor() {
      this.defaultTab = 'my-profile';
      this.validTabs = ['my-profile', 'beauty_profile', 'orders', 'addresses', 'rewards', 'wishlist', 'reviews'];
      this.init();
    }

    init() {
      this.setupEventListeners();
      this.loadInitialTab();
    }

    setupEventListeners() {
      window.addEventListener('popstate', () => this.loadTabFromURL());
    }

    loadInitialTab() {
      const tabFromURL = this.getTabFromURL();
      this.setActiveTab(tabFromURL);
      this.updateMobileSelectedItem(tabFromURL);
    }

    loadTabFromURL() {
      const tabFromURL = this.getTabFromURL();
      this.setActiveTab(tabFromURL);
      this.updateMobileSelectedItem(tabFromURL);
    }

    getTabFromURL() {
      const currentPath = window.location.pathname;
      const urlParams = new URLSearchParams(window.location.search);
      const navParam = urlParams.get('nav');

      if (currentPath.includes('/account/orders')) {
        return 'orders';
      }
      if (currentPath.includes('/account/addresses')) {
        return 'addresses';
      }
      if (currentPath.includes('/account/rewards')) {
        return 'rewards';
      }

      if (navParam) {
        const normalizedParam = navParam.replace(/_/g, '-');
        const tabExists = document.querySelector(`[data-tab="${normalizedParam}"]`);
        return tabExists ? normalizedParam : this.defaultTab;
      }

      if (window.location.hash === '#orders-section') {
        return 'orders';
      }

      if (window.location.search.includes('page=')) {
        return 'orders';
      }

      return this.defaultTab;
    }

    navigateToTab(contentType) {
      if (contentType === 'logout') {
        localStorage.removeItem('customerWishlist');
        window.location.href = '{{ routes.account_logout_url }}';
        return;
      }

      if (contentType === 'addresses') {
        window.location.href = '/account/addresses';
        return;
      }

      const tabName = contentType.replace(/_/g, '-');

      if (window.location.pathname === '/account' || window.location.pathname.endsWith('/account')) {
        const url = new URL(window.location);
        url.searchParams.set('nav', contentType);
        history.pushState({ tab: contentType }, '', url);

        this.setActiveTab(tabName);
        this.updateMobileSelectedItem(tabName);
        this.closeMobileDropdown();
      } else {
        window.location.href = `/account?nav=${contentType}`;
      }
    }

    setActiveTab(tabName) {
      const allItems = document.querySelectorAll('.customer-account__sidebar-item[data-tab]');
      allItems.forEach((item) => item.classList.remove('active'));

      const activeItem = document.querySelector(`[data-tab="${tabName}"]`);
      if (activeItem) {
        activeItem.classList.add('active');
      }

      if (window.showAccountContent) {
        const contentType = tabName.replace(/-/g, '_');
        window.showAccountContent(contentType);
      }
    }

    updateMobileSelectedItem(tabName) {
      const selectedContent = document.getElementById('selected-item-content');
      const activeItem = document.querySelector(`[data-tab="${tabName}"]`);

      if (activeItem && selectedContent) {
        const icon = activeItem.querySelector('svg') || activeItem.children[0];
        const title = activeItem.querySelector('.account-sidebar-item-title');

        if (icon && title) {
          selectedContent.innerHTML = `
            ${icon.outerHTML}
            <h2 class="account-sidebar-item-title ff-general-sans fs-16-lh-16-ls-0 fw-500">
              ${title.textContent}
            </h2>
          `;
        }
      }
    }

    closeMobileDropdown() {
      const dropdown = document.getElementById('dropdown-menu');
      const arrow = document.getElementById('dropdown-arrow');
      if (dropdown && arrow) {
        dropdown.classList.remove('expanded');
        arrow.classList.remove('expanded');
      }
    }
  }

  document.addEventListener('DOMContentLoaded', () => {
    window.sidebarNavigation = new SidebarNavigation();
  });

  function toggleDropdown() {
    const dropdown = document.getElementById('dropdown-menu');
    const arrow = document.getElementById('dropdown-arrow');

    dropdown.classList.toggle('expanded');
    arrow.classList.toggle('expanded');
  }

  function selectItem(element, iconName, title, contentType) {
    const selectedContent = document.getElementById('selected-item-content');
    const iconHtml = element.querySelector('svg') ? element.querySelector('svg').outerHTML : '';

    selectedContent.innerHTML = `
      ${iconHtml}
      <h2 class="account-sidebar-item-title ff-general-sans fs-16-lh-16-ls-0 fw-500">
        ${title}
      </h2>
    `;

    if (window.sidebarNavigation) {
      window.sidebarNavigation.navigateToTab(contentType);
    } else {
      if (window.showAccountContent) {
        window.showAccountContent(contentType);
      }
    }

    const dropdown = document.getElementById('dropdown-menu');
    const arrow = document.getElementById('dropdown-arrow');
    dropdown.classList.remove('expanded');
    arrow.classList.remove('expanded');
  }

  document.addEventListener('click', function (event) {
    const sidebar = document.querySelector('.customer-account__sidebar');
    const dropdown = document.getElementById('dropdown-menu');
    const arrow = document.getElementById('dropdown-arrow');

    if (sidebar && !sidebar.contains(event.target)) {
      dropdown.classList.remove('expanded');
      arrow.classList.remove('expanded');
    }
  });
</script>
