<link
  id="ModelViewerStyle"
  rel="stylesheet"
  href="https://cdn.shopify.com/shopifycloud/model-viewer-ui/assets/v1.0/model-viewer-ui.css"
  media="print"
  onload="this.media='all'"
>
<script type="module" src="https://unpkg.com/@google/model-viewer/dist/model-viewer.min.js" async></script>

<style>
  .product-media-gallery {
    opacity: 0;
    visibility: hidden;
    transition: opacity 0.3s ease;
  }
  .product-media-gallery.loaded {
    opacity: 1;
    visibility: visible;
  }
  .main-media-container {
    position: relative;
    border-radius: 12px;
    overflow: hidden;
    background-color: #f8f8f8;
    aspect-ratio: 1 / 1;
  }
  .main-media-wrapper {
    width: 100%;
    height: 100%;
  }
  .main-media-item {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    opacity: 0;
    visibility: hidden;
    transition: opacity 0.3s ease, visibility 0.3s ease;
    display: flex;
    align-items: center;
    justify-content: center;
  }
  .main-media-item.active {
    opacity: 1;
    visibility: visible;
  }
  .main-media-item img,
  .main-media-item video,
  .main-media-item iframe,
  .main-media-item model-viewer {
    width: 100%;
    height: 100%;
    object-fit: cover;
    background-color: transparent;
  }
  /* Styles from your product-media-thumbnails snippet */
  .media-thumbnails {
    display: flex;
    gap: 8px;
    width: 100%;
    justify-content: center; /* Or left, depending on your design */
    flex-wrap: wrap;
  }
  .media-thumbnail {
    flex-shrink: 0;
    border: 2px solid transparent;
    border-radius: 8px;
    overflow: hidden;
    background: #f5f5f5;
    cursor: pointer;
    transition: all 0.2s ease;
    padding: 0;
    position: relative;
  }
  .media-thumbnail.active {
    border-color: #333;
  }
  .media-thumbnail:focus-visible {
    outline: none;
    border-color: #007bff;
    box-shadow: 0 0 0 2px rgba(0, 123, 255, 0.25);
  }
  .thumbnail-wrapper {
    position: relative;
    width: 100%;
    height: 100%;
    display: flex;
    align-items: center;
    justify-content: center;
  }
</style>

<product-media-gallery class="product-media-gallery flex flex-col gap-16">
  <div class="main-media-container">
    <div class="main-media-wrapper">
      {%- for media in product.media -%}
        <div class="main-media-item media block relative {% if forloop.first %}active{% endif %}"
             data-media-id="{{ media.id }}"
             data-media-type="{{ media.media_type }}">

          {%- case media.media_type -%}
            {%- when 'image' -%}
              {%- comment %} Your original image snippet is restored here. {%- endcomment -%}
              {%- capture sizes %}{% render 'sizes-attribute', grid: true, min: 1, sm: 1, lg: 1, xl: 1 %}{% endcapture -%}
              {%- render 'image-desktop-and-mobile',
                  class: 'img-fit',
                  desktop_image: media,
                  mobile_image: media,
                  src_width_mobile: 980,
                  widths_mobile: '480, 980, 1200, 1400',
                  src_width_desktop: 1440,
                  widths_desktop: '578, 578, 578, 578, 578, 578, 578, 578',
                  lazy_load: true,
                  fetchpriority: "high",
                  sizes: sizes,
                  block: block
                -%}

            {%- when 'video' -%}
              <video playsinline controls preload="metadata" poster="{{ media.preview_image | image_url: width: 1440 }}">
                {%- for source in media.sources -%}
                  <source src="{{ source.url }}" type="{{ source.mime_type }}">
                {%- endfor -%}
                Your browser does not support the video tag.
              </video>

            {%- when 'external_video' -%}
              {%- assign video_url = media.external_id | prepend: 'https://www.youtube.com/embed/' | append: '?enablejsapi=1' -%}
              {%- if media.host == 'vimeo' -%}
                {%- assign video_url = media.external_id | prepend: 'https://player.vimeo.com/video/' -%}
              {%- endif -%}
              <iframe src="{{ video_url }}" frameborder="0" allow="autoplay; encrypted-media; picture-in-picture" allowfullscreen></iframe>

            {%- when 'model' -%}
              <model-viewer
                src="{{ media | model_viewer_tag | split: 'src="' | last | split: '"' | first }}"
                poster="{{ media.preview_image | image_url: width: 1440 }}"
                alt="{{ media.alt | escape }}"
                camera-controls
                auto-rotate
                ar
                ar-modes="webxr scene-viewer quick-look"
                environment-image="neutral">
              </model-viewer>
          {%- endcase -%}
        </div>
      {%- endfor -%}
    </div>
  </div>

  <div class="media-thumbnails">
    {%- render 'product-media-thumbnails', product: product -%}
  </div>
</product-media-gallery>

<script src="{{ 'product-media-gallery.js' | asset_url }}" defer></script>